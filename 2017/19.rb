input = <<EOS
                                                                           |                                                                                                                             
     +-+         +---+   +---+   +-----------------------------------------|---+                                             +---+ +-------------------------------------+         +-------------------+ 
     | |         |   |   |   |   |                                         |   |                                             |   | |                                     |         |                   | 
 +-------------------|-------|-------------+                           +---|-------------------------------+                 |   +---------------------------------+     |         |                   | 
 |   | |         |   |   |   |   |         |                           |   |   |                           |                 |     |                               |     |         |                   | 
 |   | |         |   +---|---|---|---------|---------------------+     |   |   |                           |                 |     |   +---+                       |     |         |                   | 
 D   | |         |       |   |   |         |                     |     |   |   |                           |                 |     |   |   |                       |     |         |                   | 
 |   | |         |   +---|---+   |     +---|-------------+       |   +-+ +-|---|---------------------------|---------------------+ |   |   |                       |     |         |     +---------+   | 
 |   | |         |   |   |       |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |   +-|---------|---|-------+   |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |     |         |   |   |   |   |     |   |             |       |   |   | |   |                           |                 |   | |   |   |                       |     |         |     |         |   | 
 |   +-|---------|---------------|-----|---|---------------------|---|-----|---|--------------------F------------------------------+   +-----------------+         |     |         |     |         |   | 
 |   | |         |   |   |   |   |     |   |             |       |   |   | |   |                           |                 |   |         |             |         |     |         |     |         |   | 
 |   +-|-----+   |   | +-|---|---|-----|---|---------------------|-------|---------------------------------------------+     |   |         |             |         |     |         |   +-+ +---------+ | 
 |     |     |   |   | | |   |   |     |   |             |       |   |   | |   |                           |           |     |   |         |             |         |     |         |   |   |       | | | 
 |     |     |   |   | | |   |   |   +-|-------------------------|---------+   |       +-------------------|-----------|-----|---+       +-------------+ +-+       |     | +-----------+   |       | | | 
 |     |     |   |   | | |   |   |   | |   |             |       |   |   |     |       |                   |           |     |           | |           |   |       |     | |       |       |       | | | 
 |     |     |   |   | | |   +---|---|-----|-----------------------------+     |       |                   |           |     |           | |         +-|---|-+     |     | |       |       |       | | | 
 |     |     |   |   | | |       |   | |   |             |       |   |         |       |                   |           |     |           | |         | |   | |     |     | |       |       |       | | | 
 |     |     | +-------|-|-------|---|-|---|-------------|-----------|---------|---------------------------|---------+ |     +---+       | |         | |   | |     |     | |       |       |       | | | 
 |     |     | | |   | | |       |   | |   |             |       |   |         |       |                   |         | |         |       | |         | |   | |     |     | |       |       |       | | | 
 | +---------|-|-|-------+       |   | |   |             |   +-------|-----------------|-------------------|---------|-|-----------------|-|---------|-|---|-----------------+     |       |       | | | 
 | |   |     | | |   | |         |   | |   |             |   |   |   |         |       |                   |         | |         |       | |         | |   | |     |     | | |     |       |       | | | 
 | |   |     | | |   | +---------------|-----------------------+ |   |         |       |                   |         | |         |       | |         +-|---|-|-----------|-|-------|-------|---------|-+ 
 | |   |     | | |   |           |   | |   |             |   | | |   |         |       |                   |         | |         |       | |           |   | |     |     | | |     |       |       | |   
 | |   +-----+ | |   |     +-----------|-----------------|---|-|-----------------------|-----------------------------|-------------------|-------------|-------------------|-------|-----+ |       | +-+ 
 | |           | |   |     |     |   | |   |             |   | | |   |         |       |                   |         | |         |       | |           |   | |     |     | | |     |     | |       |   | 
 | |           | |   |   +-----------------------------------|-|---+ +-+ +-----|---------------------------|-----------|-----------------|-|-----------------------------|-|-|-----------|-|-------|-+ | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |           |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |       +-+ |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     |   | |   |             |   | | | |   | |     |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | +-|-------------------------|-|-------+     |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       | |       | | |   | |     |     | | |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       | +-------|-|-|-----------|-----|-+ |     |     | |       | | | 
 | |           | |   |   | |     | | | |   |             |   | | | |   |       |       |                   |         | |         |       |         | | |   | |     |     |   |     |     | |       | | | 
 | |   +-+     | |   |   +-----+ | +---|---|-----------------|-|---|---|-------|-------|-------------------|---------------------------+ |         | | |   | |     |     |   |     |     | |       | | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       |                   |         | |         |     | |         | | |   | |     |     |   |     |     | |       | | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       | +-----------------------+   | |     +---------|-----------|---------+     |     |   |     | +---|---------+ | | 
 | |   | |     | |   |     |   | |   | |   |             |   | | | |   |       |       | |                 |     |   | |     |   |     | |         | | |   J       |     |   |     | |   | |         | | 
 | +---|-|-----|-------+   |   | |   | |   |             | +-+ | | |   |       |       | |               +-|-----------|---------------|---------------|-----------------------------|-------+       | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |   |       |       | |               | |     |   | |     |   |     | |         | | |   |       |     |   |     | |   | | |       | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |   +-------|-------------------------+ |     |   | |     |   |     | |         | | |   |       |     |   | +---+ +-----|-|-----+ | | 
 |     | |     | |   | |   |   | |   | |   |             | |   | | |           |       | |                 |     |   | |     |   |     | |         | | |   |       |     |   | |         | | |     | | | 
 |     | |     | |   | |   |   | |   | |   |           +---|---+ +---------------------------------+       +-----|---|-------|---|-------------------|-|---|-----+ |     |   | |         | | |     | | | 
 |     | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | | |   |     | |     |   | |         | | |     | | | 
 | +---|-------|-|---|-|-------|-------|---|-----------------------|-------------------|-----------|-----------------|-----------------|---------------|---|-----------------|-----------+ | |     | | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | | |   |     | |     |   | |           | |     | | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         | +-------------|-----|-------------------|-----+ | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     | |     |   | |           | |       | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     | +-----|---|-|-----------|-+       | | 
 | |   | |     | |   | |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |     | |         |   |   |     |       |   | |           |         | | 
 | |   | |     | |   +---------------|-|-------------------|-------------------|-------|-|-----------------------------------|---|---+ | |       +-|---------------------|---|-+           |         | | 
 | |   | |     | |     |   |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |       | |   |   |     |       |   |             |         | | 
 | |   | |     | |   +---+ |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |     +-|-|---|---|-----|-------|---|-------------+         | | 
 | |   | |     | |   | | | |   | |   | |   |           | | |       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     |       |   |                       | | 
 | | +-|---------|---|---------+ |   | |   | +---------|-----------|-------------------|-|-----------------------|-----------|-------|-|-------|---|-------|-------+     |   |                       | | 
 | | | | |     | |   | | | |     |   | |   | |         | | |       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | | | |     | |   | | | |     +---------|-|-------------+       |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |   |   | | |     | | |   |   |     | |     |   |                       | | 
 | | +---------|---------------------|-------------------|---------|-----------|-------|-|---------|-------------------|-----|---+   +---|-----|-|-|-+ +-------+ | |     |   |                       | | 
 | |   | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |         | |     | | | |     |   | | |     |   |                       | | 
 | | +---------|-|-------|-|-----------------|-----------|---------|---------------------------------------------|-----------|-----------|-----+ | | |   +-|-+ | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |         | |       | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   +-------------|-----+ | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |                       | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |   +---------------+   | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   | |         | |     | | | |   | | | | | |     |   |   |               |   | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |   +-|-----+   +-------|-|-|-|-----|-----|-------|---|---------------------+ | | 
 | | | | |     | |   | | | |         | |   | |         | |         |           |       | |         |             |   | |     |     |     |     | | | |   | | | | | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | |         |     +-------------|-|---------------------------|-|-----|-----|-----|-----+ | | |   | +-|-+ | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | |         |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |               | | | | 
 | | | | |     | |   | | | |         | |   | |         | | +-------|-------------------|-|-----------------------|---|-|-----|-------------------|-------|-------------------|---|---------------+ | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |     |     |       | |         |             |   | |     |     |     |       | | |   |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |   +---------------|-------------------------|---|-|-----|-----------|-------|-|-|-+ |   |   | |     |   |   |                 | | | 
 | | | | |     | |   | | | |         | |   | |         | | |       |   | |     |       | |         |             |   | |     |     |     |       | | | | |   |   | |     |   |   |                 | | | 
 | +-|---|-----------|-|---|-----------|---|-|-----------|-|-------|-----|-----|-------|-|---------|-----------------|-|-----|-----|-------------|-----------|---|-------|-+ |   |       +---------+ | | 
 |   | | |     | |   | | | |         | |   | |         | | |       |   | |     |       | |         |             |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   +-----|-------------------------------|-|---------+             |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   | |     |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |           | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   | +-------------|-------------------------|-----|-----|-----|---------------|-|-|-|---|---|-------|---|---|-----------+       | | 
 |   | | |     | |   | | | |         | |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |   +-|-------|-|---|---|-----------+ |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |     | |     | |   | | | |           |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |       | | 
 |     | |     | |   | | | |     +-----|---|-----------|-|---------|---|-------|---------------------------------|-----|-------------------------|-|-|-|-|---|---|---------|-----|-----------|-----+ | | 
 |     | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |       | | | | |   |   | |     | | |   |       |   |     | | | 
 +-----|-|-----|-----------------------|-----|---|-----|-|-|-------------------|-------|-------------------------|---|-|-----------|-----|---+   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |                       |   | |     |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |             +---------|---|-|-+   |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
       | |     | |   | | | |     |     |   | |   |     | | |       |   |       |       | |             |         |   | | |   |     |     |   |   | | | | |   |   | |     | | |   |       |   |     | | | 
     +---|-----------|-|-|-------|---+ |   | |   +-------|-+       |   |       |       | |             |         |   | | |   |     |     |   | +---|-|---|---|---|-----+ | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
     | | |     | |   | | | |     |   | |   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 +---+ | |     | |   | | | |     |   +-+   | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 |     | |     | |   | | | |     |         | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |       |   |     | | | 
 | +---+ |   +-|-----|---|-|-----|---------------------|-|---------------------|---------|-----------------------|---|-------|-----------|-------|-|---------|-----------|-------|-------+   |     | | | 
 | |     |   | | |   | | | |     |         | |         | |         |   |       |       | |             |         |   | | |   |     |     |   | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | +---|-----|-|-------|-|---------------|-|-----------|---------+   |       +-------|-|-------------|-------------|-------|-----|-----|-+ | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | |   |   | | |   | | | |     |         | |         | |             |               | |             |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |           |     | | | 
 | | +-----------|---+ | | |     |         | |         | |             |               | |           +-|---------|---|-------|-----|-----|-|---|-|-|---|-------------------|-|-------------+ |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | | |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |         | |     | | | 
 | |     |   | | |     | +-------|---------|-------------|-----------------------------|---------------|---------------------|-----------|-|-|-|-|-|-|-----------|-|-----|-----------+     +-|-+   | | | 
 | |     |   | | |     |   |     |         | |         | |             |               | |           | |         |   | | |   |     |     | | | | | | | | |   |   | |   | | | |   |   |       | |   | | | 
 | |     |   | | |     |   | +---|---------------------|-|-------------|---------------+ +-----------|-----------|---|-|-|---|-----|---------|-|-|-|-|-|---------------+ | | |   |   |       | |   | | | 
 | |     |   | | |     |   | |   |         | |         | |             |                             | |         |   | | |   |     |     | | | | | | | | |   |   | |     | | |   |   |       | |   | | | 
 +-|-----|-----|-----------|---------------|-|---------|-|-------------|---------+       +-----------|-|---------|-----|-|---------|-----|-|---|-------|-|-----------------|-----|-----------|-|-+ | | | 
   |     |   | | |     |   | |   |         | |         | |             |         |       |           | |         |   | | |   |     |     | | | | | | | | |   |   | |     | | |   |   |       | | | | | | 
   |     |   | | |     |   | |   |   +-------|---------|-|-------------|-----------------------------|---+       |   +-|-|---------------|-----|-------|-|---+   | |     | | |   |   |       | | | | | | 
   |     |   | | |     |   | |   |   |     | |         | |             |         |       |           | | |       |     | |   |     |     | | | | | | | | |       | |     | | |   |   |       | | | | | | 
   |     | +-|-----+   |   | |   |   |     | |         | |         +---|-----------------------------|-----------------|-|---------------|---------------------+ | |     | | |   |   |       | | +-+ | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |       | |     | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |     +-----+   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     | |   |     |     | | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |     +-|---------|-----+ | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   |         |       |           | | |       |       |   |     |       | | | | | | | |     | | |     | | |   |   |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |   +-----------+     |           | | |       |       |   |     |       | | | | | | | |     | | |     +-|-------+ |     | | | |   | | 
   |     | | | | | |   |   | |   |   |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   | +---+   |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | |         |             | |     |           | | |       |       |   |     |       | | | | | | | |     | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | +-------|-------------|--------------O----|-|---------------------------|-------|-|---|-|-|-------+ | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           | | |       |       |   |     |       | | | | | | | |   | | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           | +-|-+     |       |   |     |       | +-----|-------+ | | | |       | |   | | |     | | | |   | | 
   |     | | | | | |   |   |         |     | |         | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | | +-|-----------------------|---------+ | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |       | | | |       |             | |     |           |   | |     |       |   |     |       |   | | | | | | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |       +---|-------------------------------+           |   | +-----|-----------|-----------------|-----|-+ | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |                 |   |       |       |   |     |       |   | | | |   | | | | | |       | |   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             +---|-------------------------------------|---|-----|---|---|-|-|-----------+   | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |         |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | | | | |       |     | | |     | | | |   | | 
   |     | | | |   |   |   |     +-----------|---------|---|-------|-------------|---------------|---|---|-------|-------|---------|-----------|-|---|---|-|-|-+ | |       |     | +-|-----------|-+ | | 
   |     | | | |   |   |   |     |   |     | |         | | |       |             | |             |   |   |       |       |   |     |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | | |   |   |   |     |   |     | |       +-|-------------------------|---------------|-------|---------------|-------+ |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | | |   |   |   |     |   |     | |       | | | |       |             | |             |   |   |       |       |   |   | |       |   | | | |   | | |   | |       |     |   |     | | | | | | | 
   |     | | +---------|---------|---------|-+       | | | |       |           +-|-------------------|-----------|-------|-------|-|-------|---|---|-|---|---|---+ |       |     |   |     | | | | | | | 
   |     | |   |   |   |   U     |   |     |         | | | |       |           | | |             |   |   |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | | | | | 
 +-|---+ | | +---------|---|---------|-------+       | | | |       |           | | |   +-----------+ +---|---------------------------------|-----|-----------------|-----------------|-----------|-+ | | 
 | |   | | | | |   |   |   |     |   |     | |       | | | |       |           | | |   |         | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | |   |   |   |     |   |     | |       | | +-|-------|-------------|-|---+         | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | |   |   |   |     |   |     | |       | |   |       |           | | |             | |     |       |       |   |   | |       |   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | +-------------------|-----|-|-------|-|---|-------------------|-|---------------|-|---------------------|---|-------------+   | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |             | |     |       |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |   +-----------|---------+   |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | | | | |   |   |     |   |     | |       | |   |       |           | | |   |         | |     |   |   |       |   |   | |           | | | |   | | |     |       |     |   |     | | | |   | | 
 | |   | | | +-|-|-|-------|-----|---+ +---|-+   +---|-----|-----------------------|---|-------------------------|-----------|---|-|-----------|-|-------|-+ |     |       |     |   |     | | | |   | | 
 | |   | | |   | | |   |   |     |     |   |     |   | |   |       |           | | |   |         | |     |   |   |       |   |   | |           | | | |   |   |     |       |     |   |     | | | |   | | 
 | |   | | |   | | |   |   |     +---+ |   |     |   +-|-----------|-------------|---------------|-|-------------|---------------|-----------+ | | +-+   | +-------|-------------+   |     | | | |   | | 
 | |   | | |   | | |   |   |         | |   |     |     |   |       |           | | |   |         | |     |   |   |       |   |   | |         | | |       | | |     |       |         |     | | | |   | | 
 +-|-----|-|---|-----------|---------|-|---|-----------|---|-------|-------------|---------------|-----+ |   |   |       | +-|-+ | |         | | |       | | |     |       |         |     | | | |   | | 
   |   | | |   | | |   |   |         | |   |     |     |   |       |           | | |   |         | |   | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | +-----|-------|---|---|-----+   | |   |     |   +-|---|---------------------------|-----------+   | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | | | | |   | | |   |   |     |   | |   |     |   | |   |       |           | | |   |         |     | |   |   |       | | | | | |         | | |       | | |     |       |         |     | | | |   | | 
   | | | | |   | | +-------|-----|-----|---|---------|-------------|-----------|-|-|---|---------|-----|---------|---------+ | | | |         | | |       | | +-----------------------------+ | | |   | | 
   | | | | |   | |     |   |     |   | |   |     |   | |   |       |           | | |   |         |     | |   |   |       |   | | | |         | | |       | |       |       |         |       | | |   | | 
   | | | | |   | |     +---|---------|-----|---------+ | +-|--------------T------|-|---|---------|-----+ +-------|-----------|---|-----------|-----------|-+       |       |         |       | | |   | | 
   | | | | |   | |         |     |   | |   |     |     | | |       |           | | |   |         |           |   |       |   | | | |         | | |       |         |       |         |       | | |   | | 
 +-|---|-------|-----------|---------|-----------------|-----------|---------------|---|-------------------------|-------|-----|---|-----------+ |       |         |       |         |       | | |   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |           | | |   |         |           |   |       |   | | | |         |   |       |         |       |         |       | | |   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |           +-|-|-------------|-----+     +---|-------+ +-+ | | | +-------|-----------|---------|-------|---------|---------|-+   | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 | | | | | |   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         |         |   | | | |       |   |       |         |       |         |       | |     | | 
 +---------+   | |         |     |   | |   |     |     | | |       |             | |   |         |     |         | +-----------|-------------|-+ |       | +-------|-------|-------------------------|-+ 
   | | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |         | |       |   | | | |       | | |       | |       |       |         |       | |     |   
 +-+ | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |         +---------|---|---|---------|-|-|-----------------------+ |         +-------|-+     +-+ 
 |   | | |     | |         |     |   | |   |     |     | | |       |             | |   |         |     |           |       |   | | | |       | | |       | |       |     | |                 |         | 
 |   | | |     | |         |     +---+ |   |     |     | +-|---------------------|-|-------------|-----|-----------------------|-----|---------------------|-------+     | |                 |         | 
 |   | | |     | |         |           |   |     |     |   |       |             | |   |         |     |           |       |   | | | |       | | |       | |             | |                 |         | 
 |   | | |     +-|---------|---------------|-----+     |   |       |         +-------------------|-----|-----+     +-------|---|---|-|---------|---------|---------------|-|-+               |         | 
 |   | | |       |         |           |   |           |   |       |         |   | |   |         R     |     |             |   | | | |       | | |       | |             | | |               |         | 
 |   | | |       |         |           |   |     +---------------------------|-----|-------------|-----------|-----------------|-|---|-----------|-------|-----------------|-|---------------|---------+ 
 |   | | |       |         |           |   |     |     |   |       |         |   | |   |         |     |     |             |   | | | |       | | |       | |             | | |               |           
 |   | +-|-------|---------|---------------------------|---|-------|-------------------|---------|-------------------------+   +---|-+   +---|-+ |       | |             | | |               |           
 |   |   |       |         |           |   |     |     |   |       |         |   | |   |         |     |     |                   | |     |   |   |       | |             | | |               |           
 +-------|-------|---------|---------------------------------------|---------|-----|-------------------|-+   |                   | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |   |       |         |   | |   |         |     | |   |                   | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |   +-------------------------------------------|-+   +-----+             | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |           |         |   | |   |         |     |           |             | |     |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |           +-----------------------------+     |           +-------+     +-|---+ |   |   |       | |             | | |               |           
     |   |       |         |           |   |     |     |                     |   | |   |               |                   |       |   | |   |   |       | |             | | |               |           
     |   +-------|---------|-----------|---------+ +---|---+                 |   | |   |               +-------+           |       | +-------|---+       | |             | | |               |           
     |           |         |           |   |       |   |   |                 |   | |   |                       |           |       | | | |   |           | |             | | |               |           
 +---------------|-------------------------|-------|---|---|---------------------|-|---+                       +-----------|A------------------------------|-----------+ | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |         |           |   |       |   |   |                 |   | |                                       |       | | | |   |           | |           | | | |               |           
 |   |           |       +-|-----------------------+   |   +-----------------|---+ +---------------------------------------+       | | +-+   +-------------------------+ | | |               |           
 |   |           |       | |           |   |           |                     |                                                     | |                   | |             | | |               |           
 +---+   +---+   |       | |       +-------------------|---------------------------------------------------------------------------+ |                   | |             | | |               |           
         |   |   |       | |       |   |   |           |                     |                                                       |                   | |             | | |               |           
 +-----------+   |       | |       |   |   |           |                     +-----------------------------------------+             |                   +-|-------------------------------------------+ 
 |       |       |       | |       |   |   |           |                                                               |             |                     |             | | |               |         | 
 +-+     |       +---------|-------+   |   |           +---------------------------------------------------------------+             +-----------------------------------------------------------------+ 
   |     |               | |           |   |                                                                                                               |             | | |               |           
 Q-+     +---------------+ +-----------+   +---------------------------------------------------------------------------------------------------------------+             +-+ +---------------+           
                                                                                                                                                                                                         
EOS

grid = input.lines.map do |line|
  line.chomp!

  line.chars
end

row = 0
col = grid[row].index("|")
dir = :down

steps = 0
letters = []
finished = false

until finished do
  cell = grid[row][col]

  case cell
  when "|", "-"
    # no-op
  when ("A".."Z")
    letters << cell
  when "+"
    case dir
    when :up, :down
      if grid[row][col-1] == "-"
        dir = :left
      elsif grid[row][col+1] == "-"
        dir = :right
      else
        raise "uh oh..."
      end
    when :left, :right
      if grid[row-1][col] == "|"
        dir = :up
      elsif grid[row+1][col] == "|"
        dir = :down
      else
        raise "uh oh..."
      end
    end
  else
    puts "finished in cell #{cell.inspect} (#{row}, #{col}) going #{dir}"
    finished = true
  end

  steps += 1

  case dir
  when :up    then row -= 1
  when :down  then row += 1
  when :left  then col -= 1
  when :right then col += 1
  else raise "unknown dir #{dir.inspect}"
  end
end

puts letters.join("")
puts steps - 1
